<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>index</title>
		<meta name="description" content="">
		<meta name="author" content="LC">
		<meta name="viewport" content="width=device-width; initial-scale=1.0">
		<link rel="shortcut icon" href="/favicon.ico">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">

		<link href="css/main.css" rel="stylesheet">
		<link href="css/menu.css" rel="stylesheet">
		<link href="css/panel.css" rel="stylesheet">
		<link href="css/steeringWheel.css" rel="stylesheet">
		<link href="css/button.css" rel="stylesheet">
		<link href="css/numberPicker.css" rel="stylesheet">
	</head>

	<body>
		<div ng-app="myApp" ng-controller="myApp" class="main-desktop">
			<!--起始场景-->
			<div ng-controller="scene-start" ng-hide="viewControl.display.sceneStartHide" ng-class="{'hide-animation-scene':viewControl.currentScene!='scene-start','show-animation-scene':viewControl.currentScene=='scene-start'}" class="scene">
				<div ng-click="buttonstart()" class="button" style="top:200px;left:200px;">
					<div class="button-background">
						<div class="button-background2"></div>
					</div>
					<div class="button-content">
						start
					</div>
				</div>
			</div>
			<!--xx场景-->
			<div ng-controller="scene-main" ng-hide="viewControl.display.sceneMainHide" ng-class="{'hide-animation-scene':viewControl.currentScene!='scene-main','show-animation-scene':viewControl.currentScene=='scene-main'}" class="scene">

				<!--交流信息面板-->
				<div ng-click="panelOnClick(viewDataModel.panelText)" class="panel" style="bottom:20px;left:10px;">
					<div>
						{{viewDataModel.panelText}}
					</div>
					<div class="panel-lamp"></div>
				</div>

				<div class="panel2" style="top:10px;left:10px;">
					<span>{{viewDataModel.panel2Text}}</span>
				</div>
				<!--ng-mousedown="test()" ng-mouseup="test2()" ng-mouseleave="test2()"-->
				<div ng-rightclick="testright()"  class="panel3" style="top:60px;left:20px;">
					<div class="panel3-tittle">
						{{viewDataModel.panel3.tittleText}}
					</div>
				</div>

				<!--人物交互面板(按钮组)-->
				<div ng-controller="panel4" ng-hide="viewControl.display.panel4Hide" class="panel4" style="top:60px;left:330px;">
					<div ng-click="onClick($event,$index)" ng-repeat="x in viewDataModel.panel4.buttonElements" class="button2">
						<div class="button2-background"></div>
						<div class="button2-background2"></div>
						<div class="button2-background3"></div>
						<div class="button2-content">
							{{x.getName()}}
						</div>
					</div>
				</div>

				<!--方向盘-->
				<div ng-controller="steeringWheel" ng-hide="viewControl.display.steeringWheelHide" ng-style="viewControl.steeringWheel_Style" class="steeringWheel">
					<div ng-repeat="x in arrows" ng-class="{'steeringWheel-upperArrow':{{x}}=='1','steeringWheel-rightArrow':{{x}}=='2','steeringWheel-lowerArrow':{{x}}=='3','steeringWheel-leftArrow':{{x}}=='4'}">
						<!--steeringWheel-upperArrow-->
						<div ng-click="arrowOnClick($index)" ng-class="{'steeringWheel-upperArrow-graphical':{{x}}=='1','steeringWheel-rightArrow-graphical':{{x}}=='2','steeringWheel-lowerArrow-graphical':{{x}}=='3','steeringWheel-leftArrow-graphical':{{x}}=='4'}">
							<div class="steeringWheel-arrow1"></div>
							<div class="steeringWheel-arrow2"></div>
							<div class="steeringWheel-arrow3"></div>
							<div class="steeringWheel-arrow4"></div>
							<div class="steeringWheel-arrow5"></div>
						</div>
						<div ng-class="{'steeringWheel-upperArrow-shadow':{{x}}=='1','steeringWheel-rightArrow-shadow':{{x}}=='2','steeringWheel-lowerArrow-shadow':{{x}}=='3','steeringWheel-leftArrow-shadow':{{x}}=='4','steeringWheel-upperArrow-shadow-jsAnimation':{{x}}+'-1'==animation}">
							<div class="steeringWheel-arrow1"></div>
							<div class="steeringWheel-arrow2"></div>
							<div class="steeringWheel-arrow3"></div>
							<div class="steeringWheel-arrow4"></div>
							<div class="steeringWheel-arrow5"></div>
						</div>
						<div ng-class="{'steeringWheel-upperArrow-shadow':{{x}}=='1','steeringWheel-rightArrow-shadow':{{x}}=='2','steeringWheel-lowerArrow-shadow':{{x}}=='3','steeringWheel-leftArrow-shadow':{{x}}=='4','steeringWheel-upperArrow-shadow-jsAnimation':{{x}}+'-2'==animation}">
							<div class="steeringWheel-arrow1"></div>
							<div class="steeringWheel-arrow2"></div>
							<div class="steeringWheel-arrow3"></div>
							<div class="steeringWheel-arrow4"></div>
							<div class="steeringWheel-arrow5"></div>
						</div>
					</div>
				</div>

				<!--列表菜单-遮罩层-->
				<div ng-controller="menuAutoMaskLayer" ng-hide="viewControl.display.menuAutoMaskLayerHide"  ng-style="viewControl.menuAutoMaskLayer_Style" ng-click="menuAutoMaskLayerClick($event)" class="maskLayer" ></div>
				<!--列表菜单（自动大小_带箭头）-->
				<div id="menuAuto" ng-controller="menu" ng-hide="viewControl.display.menuHide" ng-style="viewControl.menu_Style" ng-class="{'hide-animation':menuHide,'show-animation':!menuHide}" class="menuAuto-background">
					<div class="menuAuto">
						<div ng-click="menulistClick($index)" ng-repeat="y in viewDataModel.menu.buttonElements" class="menuAuto-list">
							<div class="menuAuto-list-background2"></div>
							<div class="menuAuto-list-content">
								{{y.getName()}}
							</div>
							<div class="menuAuto-arrow">
								<div class="menuAuto-arrow1"></div>
								<div class="menuAuto-arrow2"></div>
								<div class="menuAuto-arrow3"></div>
								<div class="menuAuto-arrow4"></div>
								<div class="menuAuto-arrow5"></div>
							</div>
						</div>
					</div>
				</div>
				
				<!--列表菜单:包裹-->
				<div ng-hide="viewControl.display.menuBagHide" ng-style="viewControl.menu_bag_Style" ng-class="{'hide-animation':menuBagHide,'show-animation':!menuBagHide}" class="menu-background">
					<div class="menu">
						{{viewDataModel.menu.tittleText}}
						<div ng-click="menulistClick()" ng-repeat="y in viewDataModel.menuBag.buttonElements" class="menu-list">
							<div class="menu-list-background"></div>
							<div class="menu-list-background2"></div>
							<div class="menu-list-content">
								{{y.getName()}}
							</div>
						</div>
					</div>
				</div>
				
				<!--仓库-遮罩层-->
				<div ng-controller="panel5MaskLayer" ng-hide="viewControl.display.panel5MaskLayerHide"  ng-style="viewControl.panel5MaskLayer_Style" ng-click="panel5MaskLayerClick($event)" class="maskLayer" ></div>
				<!--仓库-->
				<div ng-controller="panel5" ng-hide="viewControl.display.panel5Hide" ng-style="viewControl.panel5_Style" ng-class="{'hide-animation':panel5Hide,'show-animation':!panel5Hide}" class="panel5">
					<div class="panel5-tittle">
						{{viewDataModel.panel5.tittleText}}
					</div>
					<div class="menu" style="width: 500px;height: 340px;left:10px;">
						<div ng-click="onClick($event,$index)" ng-repeat="x in viewDataModel.panel5.buttonElements" class="button2">
							<div class="button2-background"></div>
							<div class="button2-background2"></div>
							<div class="button2-background3"></div>
							<div class="button2-content-position">
								<div ng-class="{'button2-content2':{{x.getName().length}}<6,'button2-content-scroll':{{x.getName().length}}>5}">
									{{x.getName()}}
								</div>
							</div>
							<div class="button2-content-suffix">
								×{{x.getTotalNum()}}
							</div>
						</div>
					</div>
				</div>
				
				<div class="numberPicker-background">
					<div class="numberPicker">
						<div class="numberPicker-tittle">文本文本</div>
						<div class="numberPicker-upperArrow">
							<div class="numberPicker-arrow1"></div>
							<div class="numberPicker-arrow2"></div>
							<div class="numberPicker-arrow3"></div>
						</div>
						<div class="numberPicker-numberBox">999
							<!--<div class="numberPicker-numberText"></div>-->
						</div>
						<div class="numberPicker-lowerArrow">
							<div class="numberPicker-arrow1"></div>
							<div class="numberPicker-arrow2"></div>
							<div class="numberPicker-arrow3"></div>
						</div>
						<div class="numberPicker-button">确定按钮</div>
					</div>
				</div>
				
				<!--未实装组件-->
				<!--遮罩层
				<div ng-controller="maskLayer" ng-hide="viewControl.display.maskLayerHide" ng-click="maskLayerClick($event)" class="maskLayer" ></div>
				--><!--列表菜单（自动大小_带箭头）
				<div ng-hide="false" class="menuAuto-background">
					<div class="menuAuto">
						<div ng-click="menulistClick($index)" class="menuAuto-list">
							<div class="menuAuto-list-background2"></div>
							<div class="menuAuto-list-content">
								中文
							</div>
							<div class="menuAuto-arrow">
								<div class="menuAuto-arrow1"></div>
								<div class="menuAuto-arrow2"></div>
								<div class="menuAuto-arrow3"></div>
								<div class="menuAuto-arrow4"></div>
								<div class="menuAuto-arrow5"></div>
							</div>
						</div>
					</div>
				</div>
				-->
				<!--列表菜单
				<div ng-hide="viewControl.display.menuHide" ng-style="viewControl.menu_Style" ng-class="{'hide-animation':menuHide,'show-animation':!menuHide}" class="menu-background">
					<div ng-controller="menu" class="menu">
						{{viewDataModel.menu.tittleText}}
						<div ng-click="menulistClick($index)" ng-repeat="y in viewDataModel.menu.buttonElements" class="menu-list">
							<div class="menu-list-background"></div>
							<div class="menu-list-background2"></div>
							<div class="menu-list-content">
								{{y.getName()}}
							</div>
						</div>
					</div>
				</div>
				-->
				
			</div>
		</div>
		<script src="js/angular.js"></script>
		<script src="js/main.js"></script>
		<script src="js/data/DataModle.js"></script>
		<script src="js/viewData.js"></script>
		<script>
			//定义数据层
			/*----数据----*/
			var data = {
				/**
				 * 开始引导文本
				 */
				startText:"开始引导文本。。",
				domains:[
					/**
					 * 开场局部区域（小场景） 
					 */
					{
						name:"引导场景",
						signId:"startDomain",
						interactiveObjects:[
							{	
								name:"引导对象",
								actions:[
									{name:"对话",type:"talk",content:"对话内容"},
									{name:"移动",type:"move",content:"移动到公共场景",target:"publicDomain"},
								],
							},
						],
					},
					/**
					 * 公共场景
					 */
					{
						name:"公共场景",
						signId:"publicDomain",
						interactiveObjects:[
							{
								name:"移动对象",
								actions:[
									{name:"对话",type:"talk",content:"公共场景-移动对象-对话内容"},
									{name:"移动到私有据点场景",type:"move",content:"移动-私有据点场景",target:"homeDomain"},
								],
							},
							{
								name:"交流对象",
								actions:[
									{name:"对话",type:"talk",content:"公共场景-交流对象-对话内容"},
									{name:"其他",type:"",content:""},
								],
							},
						],
					},
					/**
					 * 私有据点场景
					 */
					{
						name:"私有据点场景",
						signId:"homeDomain",
						interactiveObjects:[
							{
								name:"移动对象",
								actions:[
									{name:"对话",type:"talk",content:"私有据点-移动对象-对话内容"},
									{name:"移动到公共场景",type:"move",content:"移动-公共场景",target:"publicDomain"},
								],
							},
							{
								name:"私有建筑",
								actions:[
									{name:"对话",type:"talk",content:"私有据点-私有建筑-对话内容"},
									{name:"使用",type:"use",content:"私有据点-私有建筑-使用"},
								],
								items:[
									{name:"物体1",type:"",content:"物体1说明",totalNum:9,
										actions:[
											{name:"对话"}
										],
									},
									{name:"物体2超长物品名字",type:"",content:"物体2说明",totalNum:19},
									{name:"物体3",type:"",content:"物体3说明",totalNum:11},
									{name:"物体4",type:"",content:"物体4说明",totalNum:1},
									{name:"物体5",type:"",content:"物体5说明",totalNum:9},
								],
							},
						],
					},
				],
			};
			
			//当前场景地图
			var currentDomain = DataModleFactory.createDomain();
			/**
			 * 当前可交互对象 
			 */
			var currentInteractiveObject = DataModleFactory.createInteractiveObject();
			/**
			 * 当前的物品
			 */
			var currentItem = DataModleFactory.createItem();
			
			
			var app = angular.module("myApp", []);
			app.directive('ngRightclick', function($parse) {
			    return function(scope, element, attrs) {
			        var fn = $parse(attrs.ngRightclick);
			        element.bind('contextmenu', function(event) {
			            scope.$apply(function() {
			                event.preventDefault();
			                fn(scope, {$event:event});
			            });
			        });
			    };
			});
			var deBug$RootScope = null;
			app.controller("myApp", function($scope,$rootScope,$timeout,$interval) {
				$scope.viewDataModel = viewDataModel;
				$scope.viewControl = viewControl;
				var stop;
				$rootScope.test = function(){
					stop = $interval(function() {
						console.info("test");
					}, 70);
				};
				$rootScope.test2 = function(){
					$interval.cancel(stop);
				};
				
				$rootScope.testright = function(){
					console.info("testright");
				};
				$rootScope.testright2 = function(){
					console.info("testright2");
				};
				
				/**
				 * 交流面板的打字效果方法
				 */
				panelTyping = function(str) {
					var i = 0;
					function typing() {
						if (i <= str.length) {
							viewDataModel.panelText = str.slice(0, i++) + '_';
							$timeout(typing, 50);//递归调用
						} else {
							viewDataModel.panelText = str;//结束打字,移除 _ 光标
						}
					}
					typing();
				};
				/**
				 * 场景更新数据
				 */
				sceneMainDataLoad = function(domainData){
					//加载场景数据
					currentDomain.setName(domainData.name);
					currentDomain.setSignId(domainData.signId);
					for (var i=0; i < domainData.interactiveObjects.length; i++) {
						//加载可交互对象数据
						var loadInteractiveObject = DataModleFactory.createInteractiveObject();
						loadInteractiveObject.setName(domainData.interactiveObjects[i].name);
						currentDomain.addButtonElement(loadInteractiveObject);
						//加载交互动作数据
						var loadActions = domainData.interactiveObjects[i].actions;
						if (loadActions) {
							for (var j=0; j < loadActions.length; j++) {
								var tempAction = DataModleFactory.createAction();
								tempAction.setName(loadActions[j].name).setType(loadActions[j].type).setContent(loadActions[j].content).setTarget(loadActions[j].target);;
								loadInteractiveObject.addAction(tempAction);
							};
						};
						//加载交互对象所有物品数据
						var loadItems = domainData.interactiveObjects[i].items;
						if (loadItems) {
							for (var j=0; j < loadItems.length; j++) {
								var tempItem = DataModleFactory.createItem();
								tempItem.setName(loadItems[j].name).setType(loadItems[j].type).setContent(loadItems[j].content).setTotalNum(loadItems[j].totalNum);
								loadInteractiveObject.addItem(tempItem);
								//加载物品的交互动作数据
								var loadItemActions = loadItems[j].actions;
								console.info(loadItemActions);
								if (loadItemActions) {
									for (var k=0; k < loadItemActions.length; k++) {
										var tempAction2 = DataModleFactory.createAction();
										tempAction2.setName(loadItemActions[k].name).setType(loadItemActions[k].type).setContent(loadItemActions[k].content).setTarget(loadItemActions[k].target);;
										tempItem.addAction(tempAction2);
									};
								};
							}
						};
					};
				};
				//初始化
				(function () {
					//修改该对象方法，使场景视图数据可以关联
					var tempfn = currentDomain.setName;
					currentDomain.setName=function(pram){
						viewDataModel.panel2Text = pram;
						return tempfn(pram);
					};
					//初始化数据
					sceneMainDataLoad(data.domains[0]);
				})();
			});
			
			//起始场景
			app.controller("scene-start", function($scope, $rootScope, $timeout) {
				//开始按钮
				$scope.buttonstart = function() {
					//人物交互面板(按钮组)初始数据加载
					viewDataModel.panel4.buttonElements = currentDomain.getButtonElements();
					//动态效果
					viewControl.display.sceneMainHide = false;
					$timeout(function() {
						viewControl.currentScene = "scene-main";
					}, 10);
					$timeout(function() {
						viewControl.display.sceneStartHide = true;
					}, 800);
					//动态显示开始引导文本
					$timeout(function() {
						panelTyping(data.startText);
					}, 1500);
				};
			});
			
			app.controller("scene-main", function($scope, $rootScope, $timeout) {
				$scope.panelOnClick = panelTyping;
				/**
				 * 获取层叠关系数组中最大值
				 */
				getMaxZIndex = function(num){
					var maxZIndex=num?num:0;
					for (var i in viewControl.zIndexList) {
						console.info(viewControl.zIndexList[i]);
						if(viewControl.zIndexList[i]&&maxZIndex<viewControl.zIndexList[i]){
							maxZIndex=viewControl.zIndexList[i];
						}
					};
					return maxZIndex;
				};
				/**
				 * 方向盘组件 显示命令
				 */
				steeringWheelShow = function(){
					viewControl.display.steeringWheelHide = false;
					var right = viewControl.steeringWheel_Style.right;
					viewControl.steeringWheel_Style.right = Number(right.substr(0,right.length-2))-20 + "px";
					viewControl.steeringWheel_Style.opacity = 0;
					$timeout(function() {
						viewControl.steeringWheel_Style.right = Number(right.substr(0,right.length-2)) + "px";
						viewControl.steeringWheel_Style.opacity = 1;
					}, 100);
				};
				/**
				 * 方向盘组件 隐藏命令 
				 */
				steeringWheelHide = function(){
					var right = viewControl.steeringWheel_Style.right;
					viewControl.steeringWheel_Style.right = Number(right.substr(0,right.length-2))-20 + "px";
					viewControl.steeringWheel_Style.opacity = 0;
					$timeout(function() {
						viewControl.display.steeringWheelHide = true;
					}, 200);
				};
				/**
				 * 列表菜单（自动大小_带箭头）显示命令（需传入点击目标）
				 */
				menuShow = function(target){
					//获取层叠关系数组中最大值，并+1存入
					var maxZIndex = getMaxZIndex(100);
					viewControl.zIndexList["panel4"] = maxZIndex+2;
					viewControl.zIndexList["menuAutoMaskLayer"] = maxZIndex+1;
					//控制显示菜单的动画效果
					//弹出遮罩层
					viewControl.display.menuAutoMaskLayerHide = false;
					//显示菜单
					viewControl.display.menuHide = false;
					//获取相对整个场景对象的top,left
					var tempa = document.getElementById("menuAuto").parentNode;
					var tempb = target;
					var totalTop = 0;
					var totalLeft = tempb.offsetWidth;
					while (tempa!=tempb){
						totalTop += tempb.offsetTop;
						totalLeft += tempb.offsetLeft;
						tempb = tempb.parentNode;
					};
					viewControl.menu_Style.top = totalTop + "px";
					viewControl.menu_Style.left = totalLeft-20 + "px";
					viewControl.menu_Style.opacity = 0;
					viewControl.menu_Style["z-index"] = viewControl.zIndexList["panel4"];
					viewControl.menuAutoMaskLayer_Style["z-index"] = viewControl.zIndexList["menuAutoMaskLayer"];
					$timeout(function() {
						viewControl.menu_Style.left = totalLeft + "px";
						viewControl.menu_Style.opacity = 1;
					}, 100);
				};
				/**
				 * 列表菜单（自动大小_带箭头）隐藏命令（包含动画效果和view数据清理） 
				 */
				menuHide = function(){
					//控制隐藏菜单的动画效果
					var left = viewControl.menu_Style.left;
					viewControl.menu_Style.left = (Number(left.substring(0, left.length - 2)) + 20) + "px";
					viewControl.menu_Style.opacity = 0;
					$timeout(function() {
						//数据清理
						viewDataModel.menu.buttonElements = null;
						//重置层叠
						viewControl.menu_Style["z-index"] = 0;
						viewControl.menuAutoMaskLayer_Style["z-index"] = 0;
						viewControl.zIndexList["panel4"] = 0;
						viewControl.zIndexList["menuAutoMaskLayer"] = 0;
						//隐藏遮罩层
						viewControl.display.menuAutoMaskLayerHide = true;
						//隐藏菜单
						viewControl.display.menuHide = true;
					},200);
				};
				/**
				 * 仓库组件 显示命令(同时打开包裹组件)
				 */
				panel5Show = function(){
					//获取层叠关系数组中最大值，并+1存入
					var maxZIndex = getMaxZIndex(100);
					console.info(maxZIndex);
					viewControl.zIndexList["panel5"] = maxZIndex+2;
					viewControl.zIndexList["menuBag"] = maxZIndex+2;
					viewControl.zIndexList["panel5MaskLayer"] = maxZIndex+1;
					
					viewControl.panel5_Style["z-index"] = viewControl.zIndexList["panel5"];
					viewControl.menu_bag_Style["z-index"] = viewControl.zIndexList["menuBag"];
					viewControl.panel5MaskLayer_Style["z-index"] = viewControl.zIndexList["panel5MaskLayer"];
					//弹出遮罩层
					viewControl.display.panel5MaskLayerHide = false;
					
					viewControl.display.panel5Hide = false;
					viewControl.panel5_Style.left = 650 + "px";
					viewControl.panel5_Style.opacity = 0;
					//同时打开包裹
					viewControl.display.menuBagHide = false;
					viewControl.menu_bag_Style.left = 100 + "px";
					viewControl.menu_bag_Style.opacity = 0;
					$timeout(function() {
						viewControl.panel5_Style.left =  600 + "px";
						viewControl.panel5_Style.opacity = 1 + "px";
						viewControl.menu_bag_Style.left = 200 + "px";
						viewControl.menu_bag_Style.opacity = 1;
					}, 100);
				};
				/**
				 * 仓库组件 隐藏命令(同时隐藏包裹组件)（包含动画效果和view数据清理） 
				 */
				panel5Hide = function(){
					//实现隐藏菜单（包裹）的动画效果
					var left = viewControl.menu_bag_Style.left;
					viewControl.menu_bag_Style.left = (Number(left.substring(0, left.length - 2)) - 50) + "px";
					viewControl.menu_bag_Style.opacity = 0;
					//实现隐藏仓库组件的动画效果
					left = viewControl.panel5_Style.left;
					viewControl.panel5_Style.left = (Number(left.substring(0, left.length - 2)) + 50) + "px";
					viewControl.panel5_Style.opacity = 0;
					$timeout(function() {
						//仓库组件 数据清理
						viewDataModel.panel5.buttonElements = null;
						viewDataModel.panel5.tittleText = null;
						//包裹数据清理
						//重置层叠
						viewControl.zIndexList["panel5"] = 0;
						viewControl.zIndexList["menuBag"] = 0;
						viewControl.zIndexList["panel5MaskLayer"] = 0;
						viewControl.panel5_Style["z-index"] = 0;
						viewControl.menu_bag_Style["z-index"] = 0;
						viewControl.panel5MaskLayer_Style["z-index"] = 0;
						//隐藏组件
						viewControl.display.panel5MaskLayerHide = true;
						viewControl.display.panel5Hide = true;
						viewControl.display.menuBagHide = true;
					}, 200);
				};
			});

			//人物交互面板
			app.controller("panel4", function($scope, $rootScope, $timeout) {
				//点击某个交互对象
				$scope.onClick = function($event,index) {
					//处理传入对象，判断 class= button2
					var tempt = $event.target.parentNode;
					while("button2 ng-scope"!=tempt.className){
						tempt = tempt.parentNode;
					}
					//传入点击目标（用于定位），显示列表菜单
					menuShow(tempt);
					//标记当前交互对象
					currentInteractiveObject = currentDomain.getButtonElement(index);
					//加载交互对象动作数据
					viewDataModel.menu.buttonElements = currentInteractiveObject.getActions();
					//viewDataModel.menu.tittleText = currentInteractiveObject.getName();
				};
			});
			
			//交互动作菜单
			app.controller("menu", function($scope, $rootScope,$timeout) {
				//点击某个交互动作
				$scope.menulistClick = function(index){
					//获取交互动作
					var nowAction = currentInteractiveObject.getAction(index);
					if(nowAction.getType()=="talk"){
						//判断为对话
						panelTyping(nowAction.getContent());
					}else if(nowAction.getType()=="move"){
						//判断为移动，场景切换
						currentDomain.clear();
						for (var i=0; i < data.domains.length; i++) {
							if (nowAction.getTarget()==data.domains[i].signId) {
								sceneMainDataLoad(data.domains[i]);
								panelTyping(nowAction.getContent());
								break;
							};
						};
					}else if(nowAction.getType()=="use"){
						//判断为使用建筑功能（仓库）
						//加载仓库数据
						viewDataModel.panel5.buttonElements = currentInteractiveObject.getItems();
						viewDataModel.panel5.tittleText = currentInteractiveObject.getName();
						//加载包裹数据
						viewDataModel.menuBag.buttonElements = null;
						viewDataModel.menuBag.tittleText = "数据";
						panel5Show();
					}
					//隐藏菜单
					menuHide();
				};
			});

			//仓库组件
			app.controller("panel5", function($scope, $rootScope,$timeout) {
				//点击某个交互对象
				$scope.onClick = function($event,index) {
					//处理传入对象，判断 class= button2
					var tempt = $event.target.parentNode;
					while("button2 ng-scope"!=tempt.className){
						tempt = tempt.parentNode;
					}
					//传入点击目标（用于定位），显示列表菜单
					menuShow(tempt);
					//标记当前交互（物品）对象
					currentItem = currentInteractiveObject.getItem(index);
					//加载交互对象动作数据（同步至视图）
					viewDataModel.menu.buttonElements = currentItem.getActions();
					//viewDataModel.menu.tittleText = currentItem.getName();
				};
			});

			//列表菜单（自动大小_带箭头）专用遮罩层
			app.controller("menuAutoMaskLayer", function($scope, $rootScope, $timeout) {
				//点击后隐藏
				$scope.menuAutoMaskLayerClick = function($event) {
					menuHide();
				};
			});
			//仓库专用遮罩层
			app.controller("panel5MaskLayer", function($scope, $rootScope, $timeout) {
				//点击后隐藏
				$scope.panel5MaskLayerClick = function($event) {
					panel5Hide();
				};
			});
		</script>
		<script src="js/animation/steeringWheel.js"></script>

	</body>
</html>

