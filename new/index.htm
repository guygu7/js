<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>index</title>
		<meta name="description" content="">
		<meta name="author" content="LC">
		<meta name="viewport" content="width=device-width; initial-scale=1.0">
		<link rel="shortcut icon" href="/favicon.ico">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">

		<link href="css/main.css" rel="stylesheet">
		<link href="css/menu.css" rel="stylesheet">
		<link href="css/panel.css" rel="stylesheet">
		<link href="css/steeringWheel.css" rel="stylesheet">
		<link href="css/button.css" rel="stylesheet">
	</head>

	<body>
		<div ng-app="myApp" ng-controller="myApp" class="main-desktop">
			<!--起始场景-->
			<div ng-controller="scene-start" ng-hide="viewControl.display.sceneStartHide" ng-class="{'hide-animation':viewControl.currentScene!='scene-start','show-animation':viewControl.currentScene=='scene-start'}" class="scene">
				<div ng-click="buttonstart()" class="button" style="top:200px;left:200px;">
					<div class="button-background">
						<div class="button-background2"></div>
					</div>
					<div class="button-content">
						start
					</div>
				</div>
			</div>
			<!--xx场景-->
			<div ng-controller="scene-main" ng-hide="viewControl.display.sceneMainHide" ng-class="{'hide-animation':viewControl.currentScene!='scene-main','show-animation':viewControl.currentScene=='scene-main'}" class="scene">

				<!--交流信息面板-->
				<div ng-click="panelOnClick(viewDataModel.panelText)" class="panel" style="bottom:20px;left:10px;">
					<div>
						{{viewDataModel.panelText}}
					</div>
					<div class="panel-lamp"></div>
				</div>

				<div class="panel2" style="top:10px;left:10px;">
					<span>{{viewDataModel.panel2Text}}</span>
				</div>
				<div class="panel3" style="top:60px;left:20px;">
					<div class="panel3-tittle">
						{{viewDataModel.panel3.tittleText}}
					</div>
				</div>

				<!--人物交互面板(按钮组)-->
				<div ng-controller="panel4" ng-hide="panel4Hide" class="panel4" style="top:60px;left:330px;">
					<div ng-repeat="x in viewDataModel.panel4.buttonElements" ng-click="onClick($event,$index)" class="button2">
						<div class="button2-background"></div>
						<div class="button2-background2"></div>
						<div class="button2-background3"></div>
						<div class="button2-content">
							{{x.getName()}}
						</div>
					</div>
				</div>

				<!--方向盘-->
				<div ng-controller="steeringWheel" class="steeringWheel" style="bottom:55px;right:80px;">
					<div ng-repeat="x in arrows">
						<div ng-class="{'steeringWheel-upperArrow':{{x}}=='1','steeringWheel-rightArrow':{{x}}=='2','steeringWheel-lowerArrow':{{x}}=='3','steeringWheel-leftArrow':{{x}}=='4'}">
							<!--steeringWheel-upperArrow-->
							<div ng-click="arrowOnClick($index)" ng-class="{'steeringWheel-upperArrow-graphical':{{x}}=='1','steeringWheel-rightArrow-graphical':{{x}}=='2','steeringWheel-lowerArrow-graphical':{{x}}=='3','steeringWheel-leftArrow-graphical':{{x}}=='4'}">
								<div class="steeringWheel-arrow1"></div>
								<div class="steeringWheel-arrow2"></div>
								<div class="steeringWheel-arrow3"></div>
								<div class="steeringWheel-arrow4"></div>
								<div class="steeringWheel-arrow5"></div>
							</div>
							<div ng-class="{'steeringWheel-upperArrow-shadow':{{x}}=='1','steeringWheel-rightArrow-shadow':{{x}}=='2','steeringWheel-lowerArrow-shadow':{{x}}=='3','steeringWheel-leftArrow-shadow':{{x}}=='4','steeringWheel-upperArrow-shadow-jsAnimation':{{x}}+'-1'==animation}">
								<div class="steeringWheel-arrow1"></div>
								<div class="steeringWheel-arrow2"></div>
								<div class="steeringWheel-arrow3"></div>
								<div class="steeringWheel-arrow4"></div>
								<div class="steeringWheel-arrow5"></div>
							</div>
							<div ng-class="{'steeringWheel-upperArrow-shadow':{{x}}=='1','steeringWheel-rightArrow-shadow':{{x}}=='2','steeringWheel-lowerArrow-shadow':{{x}}=='3','steeringWheel-leftArrow-shadow':{{x}}=='4','steeringWheel-upperArrow-shadow-jsAnimation':{{x}}+'-2'==animation}">
								<div class="steeringWheel-arrow1"></div>
								<div class="steeringWheel-arrow2"></div>
								<div class="steeringWheel-arrow3"></div>
								<div class="steeringWheel-arrow4"></div>
								<div class="steeringWheel-arrow5"></div>
							</div>
						</div>
					</div>
				</div>

				<!--遮罩层-->
				<div ng-controller="maskLayer" ng-click="maskLayerClick($event)" ng-hide="viewControl.display.maskLayerHide" class="maskLayer" ></div>
				<!--列表菜单-->
				<div ng-hide="viewControl.display.menuHide"  class="menu-background" ng-style="panel4_menu_Style" ng-class="{'hide-animation':menuHide,'show-animation':!menuHide}">
					<div ng-controller="menu" class="menu">
						{{viewDataModel.menu.tittleText}}
						<div ng-click="menulistClick($index)" class="menu-list" ng-repeat="y in viewDataModel.menu.buttonElements">
							<div class="menu-list-background"></div>
							<div class="menu-list-background2"></div>
							<div class="menu-list-content">
								{{y.getName()}}
							</div>
						</div>
					</div>
				</div>
				
				<!--仓库-->
				<div ng-controller="panel5" class="panel5" ng-hide="viewControl.display.panel5Hide" style="top:50px;left:420px;">
					<div class="panel5-tittle">
						{{viewDataModel.panel3.tittleText}}
					</div>
					<div class="menu" style="width: 500px;height: 340px;left:10px;">
						<div ng-click="" class="button2">
							<div class="button2-background"></div>
							<div class="button2-background2"></div>
							<div class="button2-background3"></div>
							<div class="button2-content">
							</div>
						</div>
						<div ng-click="" class="button2">
							<div class="button2-background"></div>
							<div class="button2-background2"></div>
							<div class="button2-background3"></div>
							<div class="button2-content-position">
								<div class="button2-content-scroll">
									一二三四五六七八九十一
								</div>
							</div>
							<div class="button2-content-suffix">
								×99
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<script src="js/angular.js"></script>
		<script src="js/main.js"></script>
		<script src="js/data/DataModle.js"></script>
		<script>
			//定义数据层
			
			
			/*----数据----*/
			var data = {
				/**
				 * 开始引导文本
				 */
				startText:"开始引导文本。。",
				domains:[
					/**
					 * 开场局部区域（小场景） 
					 */
					{
						name:"引导场景",
						signId:"startDomain",
						interactiveObjects:[
							{	
								name:"引导对象",
								actions:[
									{name:"对话",type:"talk",content:"对话内容"},
									{name:"移动",type:"move",content:"移动到公共场景",target:"publicDomain"},
								],
							},
						],
					},
					/**
					 * 公共场景
					 */
					{
						name:"公共场景",
						signId:"publicDomain",
						interactiveObjects:[
							{
								name:"移动对象",
								actions:[
									{name:"对话",type:"talk",content:"公共场景-移动对象-对话内容"},
									{name:"移动到私有据点场景",type:"move",content:"移动-私有据点场景",target:"homeDomain"},
								],
							},
							{
								name:"交流对象",
								actions:[
									{name:"对话",type:"talk",content:"公共场景-交流对象-对话内容"},
									{name:"其他",type:"",content:""},
								],
							},
						],
					},
					/**
					 * 私有据点场景
					 */
					{
						name:"私有据点场景",
						signId:"homeDomain",
						interactiveObjects:[
							{
								name:"移动对象",
								actions:[
									{name:"对话",type:"talk",content:"私有据点-移动对象-对话内容"},
									{name:"移动到公共场景",type:"move",content:"移动-公共场景",target:"publicDomain"},
								],
							},
							{
								name:"私有建筑",
								actions:[
									{name:"对话",type:"talk",content:"私有据点-私有建筑-对话内容"},
									{name:"使用",type:"use",content:"私有据点-私有建筑-使用"},
								],
							},
						],
					},
				],
			};

			
				
				
			/*
			* angularjs数据绑定示例（指对象绑定，非基本数据绑定）
			* ps：	1.任何绑定，绑定之后都不可在变更基本绑定对象，包括重新定义和数据覆盖，只能变更对象属性，否则将无法自动刷新数据
			* 		2.属性可以任意变更
			*/
			/*
			绑定可以接受对象类型和数组类型
			定义
			var viewDataModel={"viewDataModelname":"viewDataModelnamedata"};
			或
			var viewDataModel={viewDataModelname:"viewDataModelnamedata"};
			绑定
			$rootScope.viewDataModel = viewDataModel;
			展示
			{{viewDataModel.viewDataModelname}}

			定义
			var viewDataModel=["viewDataModelnamedata"];
			绑定
			$rootScope.viewDataModel = viewDataModel;
			展示
			{{viewDataModel[0]}}
			*/

			/**
			 * 视图数据显示对象 
			 */
			var viewDataModel = {
				/**
				 * 交流信息面板文本
				 */
				panelText:"",
				/**
				 * XX面板文本 
				 */
				panel2Text:"中文",
				/**
				 * XX面板 
				 */
				panel3:{
					/**
					 * 标题文本 
					 */
					tittleText:"标题",
				},
				/**
				 * 人物交互面板(按钮组)
				 */
				panel4:{
					/**
					 * 按钮元素集合
					 */
					buttonElements:{},
				},
				/**
				 * 菜单
				 */
				menu:{
					/**
					 * 菜单标题文本 
					 */
					tittleText:"菜单标题",
					/**
					 * 按钮元素集合（文本）
					 */
					buttonElements:{},
				},
				
				
			};
			/**
			 * 视图控制对象（属性为对视图的控制属性）
			 */
			var viewControl = {
				/**
				 * 应用全局对显示的控制(初始值)
				 */
				display:{
					/**
					 * 开始界面场景隐藏
					 */
					sceneStartHide:false,
					/**
					 * xx场景隐藏
					 */
					sceneMainHide:true,
					/**
					 * 菜单隐藏 
					 */
					menuHide:true,
					/**
					 * 遮罩层隐藏 
					 */
					maskLayerHide:true,
					/**
					 * 仓库组件隐藏
					 */
					panel5Hide:true,
				},
				/**
				 * 当前所在场景（初始值） 
				 */
				currentScene : "scene-start",
			};
			//var viewDataModel=["viewDataModelnamedata"];
			
			//当前场景地图
			var currentDomain = DataModleFactory.createDomain();
			/**
			 * 当前可交互对象 
			 */
			var currentInteractiveObject = DataModleFactory.createInteractiveObject();

			var app = angular.module("myApp", []);
			app.controller("myApp", function($scope,$rootScope,$timeout) {
				$scope.viewDataModel = viewDataModel;
				$scope.viewControl = viewControl;
				/**
				 * 交流面板的打字效果方法
				 */
				panelTyping = function(str) {
					var i = 0;
					function typing() {
						if (i <= str.length) {
							viewDataModel.panelText = str.slice(0, i++) + '_';
							$timeout(typing, 50);//递归调用
						} else {
							viewDataModel.panelText = str;//结束打字,移除 _ 光标
						}
					}
					typing();
				};
				/**
				 * 场景更新数据
				 */
				sceneMainDataLoad = function(domainData){
					//加载场景数据
					currentDomain.setName(domainData.name);
					currentDomain.setSignId(domainData.signId);
					for (var i=0; i < domainData.interactiveObjects.length; i++) {
						//加载可交互对象数据
						var loadInteractiveObject = DataModleFactory.createInteractiveObject();
						loadInteractiveObject.setName(domainData.interactiveObjects[i].name);
						currentDomain.addButtonElement(loadInteractiveObject);
						//加载交互动作数据
						var loadActions = domainData.interactiveObjects[i].actions;
						for (var j=0; j < loadActions.length; j++) {
							var tempAction = DataModleFactory.createAction();
							tempAction.setName(loadActions[j].name).setType(loadActions[j].type).setContent(loadActions[j].content).setTarget(loadActions[j].target);;
							loadInteractiveObject.addAction(tempAction);
						};
					};
				};
				//初始化
				(function () {
					//修改该对象方法，使场景视图数据可以关联
					var tempfn = currentDomain.setName;
					currentDomain.setName=function(pram){
						viewDataModel.panel2Text = pram;
						return tempfn(pram);
					};
					//初始化数据
					sceneMainDataLoad(data.domains[0]);
				})();
			});
			
			//起始场景
			app.controller("scene-start", function($scope, $rootScope, $timeout) {
				//开始按钮
				$scope.buttonstart = function() {
					viewControl.display.sceneMainHide = false;
					$timeout(function() {
						viewControl.currentScene = "scene-main";
					}, 10);
					$timeout(function() {
						viewControl.display.sceneStartHide = true;
					}, 800);
					//动态显示开始引导文本
					$timeout(function() {
						panelTyping(data.startText);
					}, 1500);
					//人物交互面板(按钮组)初始数据加载
					viewDataModel.panel4.buttonElements = currentDomain.getButtonElements();
				};
			});
			
			app.controller("scene-main", function($scope, $rootScope, $timeout) {
				$scope.panelOnClick = panelTyping;
			});

			//人物交互面板
			app.controller("panel4", function($scope, $rootScope, $timeout) {
				//点击某个交互对象
				$scope.onClick = function($event,index) {
					//标记当前交互对象
					currentInteractiveObject = currentDomain.getButtonElement(index);
					//加载交互对象动作数据
					viewDataModel.menu.buttonElements = currentInteractiveObject.getActions();
					viewDataModel.menu.tittleText = currentInteractiveObject.getName();
					//控制显示菜单的动画效果
					//弹出遮罩层
					viewControl.display.maskLayerHide = false;
					//显示菜单
					viewControl.display.menuHide = false;
					var t = $event.target;
					$rootScope.panel4_menu_Style = {
						"top" : 30 + "px",
						"left" : t.offsetLeft + t.parentNode.offsetLeft + t.offsetWidth + 280 + "px",
						"opacity" : 0
					};
					$timeout(function() {
						$rootScope.panel4_menu_Style = {
							"top" : 30 + "px",
							"left" : t.offsetLeft + t.parentNode.offsetLeft + t.offsetWidth + 340 + "px",
							"opacity" : 1
						};
					}, 10);
				};
			});
			
			//交互动作菜单
			app.controller("menu", function($scope, $rootScope,$timeout) {
				//点击某个交互动作
				$scope.menulistClick = function(index){
					//获取交互动作
					var nowAction = currentInteractiveObject.getAction(index);
					if(nowAction.getType()=="talk"){
						//判断为对话
						panelTyping(nowAction.getContent());
					}else if(nowAction.getType()=="move"){
						//判断为移动，场景切换
						currentDomain.clear();
						for (var i=0; i < data.domains.length; i++) {
							if (nowAction.getTarget()==data.domains[i].signId) {
								sceneMainDataLoad(data.domains[i]);
								panelTyping(nowAction.getContent());
								break;
							};
						};
					}else if(nowAction.getType()=="use"){
						//判断为使用建筑功能（仓库）
						viewControl.display.panel5Hide = false;
						
					}
					//实现隐藏菜单的动画效果
					var left = $rootScope.panel4_menu_Style.left;
					$rootScope.panel4_menu_Style.left = (parseInt(left.substring(0, left.length - 2)) + 50) + "px";
					$rootScope.panel4_menu_Style.opacity = 0;
					$timeout(function() {
						if(nowAction.getType()=="use"){
							console.info("use");
						}else{
							//隐藏遮罩层
							viewControl.display.maskLayerHide = true;
						}
						//隐藏菜单
						viewControl.display.menuHide = true;
					}, 500);
				};
			});

			//仓库组件
			app.controller("panel5", function($scope, $rootScope,$timeout) {
				
			});

			//遮罩层
			app.controller("maskLayer", function($scope, $rootScope, $timeout) {
				//点击后隐藏
				$scope.maskLayerClick = function($event) {
					//实现隐藏菜单的动画效果
					var left = $rootScope.panel4_menu_Style.left;
					$rootScope.panel4_menu_Style.left = (parseInt(left.substring(0, left.length - 2)) + 50) + "px";
					$rootScope.panel4_menu_Style.opacity = 0;
					$timeout(function() {
						viewControl.display.maskLayerHide = true;
						//同时隐藏其他
						viewControl.display.menuHide = true;
						viewControl.display.panel5Hide = true;
					}, 500);
				};
			});

		</script>
		<script src="js/animation/steeringWheel.js"></script>

	</body>
</html>

